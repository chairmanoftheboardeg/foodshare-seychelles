<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Account — FoodShare Seychelles</title>
  <link rel="icon" href="/image/logo.png" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>

  <style>
    :root {
      --primary-light:#81C784; --primary-main:#4CAF50; --primary-dark:#388E3C;
      --accent-blue:#2196F3; --accent-orange:#FF9800; --accent-red:#D32F2F;
      --neutral-bg:#F9F9F9; --neutral-card:#FFFFFF; --text-dark:#333333; --text-light:#666666;
      --shadow-subtle:0 10px 28px rgba(0,0,0,0.10);
      --font-serif:'Georgia', serif; --font-sans:'Helvetica Neue', Arial, sans-serif;
      --transition-speed:0.35s;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:var(--font-sans);color:var(--text-dark);background:var(--neutral-bg);min-height:100vh;display:flex;flex-direction:column}
    a{text-decoration:none;color:var(--primary-main)}
    a:hover{color:var(--primary-dark)}
    main{flex:1;padding:40px 0}
    .content-container{max-width:1050px;margin:0 auto;padding:0 25px}

    /* NAVBAR */
    #navbar{display:flex;justify-content:space-between;align-items:center;padding:18px 25px;background:var(--neutral-card);box-shadow:0 4px 12px rgba(0,0,0,0.08);position:sticky;top:0;z-index:1000}
    .logo-container{display:flex;align-items:center;font-size:1.6em;font-weight:bold;color:var(--text-dark)}
    .logo-img{height:40px;margin-right:10px}
    .nav-links-container{display:flex;gap:22px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
    .nav-link{font-weight:600;padding:8px 0;position:relative;color:var(--text-dark)}
    .nav-link::after{content:'';position:absolute;width:0;height:2px;bottom:-5px;left:0;background:var(--primary-main);transition:width var(--transition-speed)}
    .nav-link:hover::after{width:100%}
    .cta-button{background:var(--primary-main);color:#fff;border-radius:999px;padding:10px 18px;font-weight:800;box-shadow:0 10px 18px rgba(0,0,0,0.10)}
    .cta-button:hover{background:var(--primary-dark)}
    .staff-login{opacity:.85}

    /* FOOTER */
    #main-footer{margin-top:auto;background:#222;color:var(--neutral-bg);padding:50px 0 20px;font-size:.9em}
    .footer-content{display:flex;justify-content:space-between;flex-wrap:wrap;margin-bottom:30px;max-width:1200px;margin:0 auto 30px;padding:0 25px;gap:18px}
    .footer-section{width:20%;min-width:180px;margin-bottom:20px}
    .footer-section h3{color:var(--primary-light);margin-bottom:14px;font-size:1.1em;border-bottom:1px solid rgba(255,255,255,0.12);padding-bottom:6px}
    .footer-section a{color:var(--neutral-bg);display:block;padding:3px 0}
    .footer-section a:hover{color:var(--primary-main);text-decoration:underline}
    .footer-bottom{text-align:center;padding-top:20px;border-top:1px solid rgba(255,255,255,0.1);color:#aaa;font-size:.85em}

    /* PAGE */
    .hero{
      display:grid;grid-template-columns:1.05fr 0.95fr;gap:22px;align-items:stretch;
      margin-top:10px;
    }
    @media (max-width: 900px){ .hero{grid-template-columns:1fr} }

    .panel{
      background:var(--neutral-card);
      border-radius:16px;
      box-shadow:var(--shadow-subtle);
      overflow:hidden;
      border:1px solid rgba(56,142,60,0.14);
      position:relative;
    }
    .panel::before{
      content:"";position:absolute;left:0;top:0;right:0;height:6px;
      background:linear-gradient(90deg,var(--primary-dark),var(--primary-main),var(--primary-light));
    }
    .panel-inner{padding:26px}

    h1{font-family:var(--font-serif);color:var(--primary-dark);font-size:2rem;margin:8px 0 8px}
    .sub{color:var(--text-light);line-height:1.7}
    .bullets{margin-top:14px;display:grid;gap:10px}
    .bullet{display:flex;gap:12px;align-items:flex-start;padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);background:#fff}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--primary-main);margin-top:6px;box-shadow:0 0 0 6px rgba(76,175,80,0.14);flex:0 0 auto}

    .tabs{display:flex;gap:10px;margin-bottom:14px;flex-wrap:wrap}
    .tab{
      border:1px solid rgba(56,142,60,0.18);
      background:#fff;
      padding:10px 14px;border-radius:999px;font-weight:900;cursor:pointer;
      transition:transform .12s ease, background .2s ease;
    }
    .tab.active{background:rgba(129,199,132,0.18);border-color:rgba(56,142,60,0.28)}
    .tab:active{transform:translateY(1px)}

    label{display:block;font-weight:800;margin:10px 0 6px}
    input{
      width:100%;padding:12px 12px;border-radius:10px;border:1px solid #d0d5dd;
      outline:none;font-size:1rem;
    }
    input:focus{border-color:rgba(76,175,80,0.55);box-shadow:0 0 0 4px rgba(76,175,80,0.14)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width: 520px){ .row{grid-template-columns:1fr} }

    .btn{
      width:100%;margin-top:14px;border:none;border-radius:999px;padding:12px 14px;
      background:var(--primary-main);color:#fff;font-weight:900;font-size:1.05rem;
      cursor:pointer;box-shadow:0 12px 22px rgba(0,0,0,0.12);
      transition:background .2s ease, transform .12s ease;
    }
    .btn:hover{background:var(--primary-dark)}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:#fff;color:var(--primary-dark);border:1px solid rgba(56,142,60,0.22);box-shadow:none}
    .btn.secondary:hover{background:rgba(129,199,132,0.12)}

    .msg{display:none;margin-top:14px;padding:12px 14px;border-radius:12px;font-weight:800}
    .msg.ok{background:rgba(129,199,132,0.22);color:var(--primary-dark);border:1px solid rgba(56,142,60,0.18)}
    .msg.err{background:rgba(211,47,47,0.12);color:var(--accent-red);border:1px solid rgba(211,47,47,0.25)}
    .tiny{margin-top:12px;color:var(--text-light);font-size:.95rem;line-height:1.6}
  </style>

  <script>
    const SUPABASE_URL = 'https://edotvuleaydztulkxehe.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVkb3R2dWxlYXlkenR1bGt4ZWhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2MDAyNDYsImV4cCI6MjA4MTE3NjI0Nn0.gDni31MI8twOpNmNcIpj1jGsra75eZ2iLL6gQM0i9lw';
    let supabase;

    function showMsg(type, text){
      const el = document.getElementById('msg');
      el.className = 'msg ' + (type === 'ok' ? 'ok' : 'err');
      el.innerHTML = text;
      el.style.display = 'block';
    }

    function setMode(mode){
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById(mode === 'login' ? 'tabLogin' : 'tabSignup').classList.add('active');
      document.getElementById('loginBox').style.display = mode === 'login' ? 'block' : 'none';
      document.getElementById('signupBox').style.display = mode === 'signup' ? 'block' : 'none';
      document.getElementById('msg').style.display = 'none';
    }

    async function redirectIfLoggedIn(){
      const { data } = await supabase.auth.getSession();
      if (data?.session?.user) window.location.href = '/dashboard/';
    }

    async function handleLogin(e){
      e.preventDefault();
      document.getElementById('msg').style.display = 'none';

      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;

      const btn = document.getElementById('loginBtn');
      btn.disabled = true;
      btn.innerHTML = 'Signing in...';

      const { data, error } = await supabase.auth.signInWithPassword({ email, password });

      btn.disabled = false;
      btn.innerHTML = 'Sign In';

      if (error) return showMsg('err', `<i class="fa-solid fa-circle-xmark"></i> ${error.message}`);

      // Community dashboard
      window.location.href = '/dashboard/';
    }

    async function handleSignup(e){
      e.preventDefault();
      document.getElementById('msg').style.display = 'none';

      const fullName = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;

      if (password.length < 8){
        return showMsg('err', `<i class="fa-solid fa-triangle-exclamation"></i> Password must be at least 8 characters.`);
      }

      const btn = document.getElementById('signupBtn');
      btn.disabled = true;
      btn.innerHTML = 'Creating account...';

      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: { data: { full_name: fullName } }
      });

      btn.disabled = false;
      btn.innerHTML = 'Create Account';

      if (error) return showMsg('err', `<i class="fa-solid fa-circle-xmark"></i> ${error.message}`);

      // If email confirmations are on, session may be null; show correct message either way.
      if (!data.session){
        showMsg('ok', `<i class="fa-solid fa-envelope"></i> Account created. Please check your email to confirm your address, then sign in.`);
        setMode('login');
        return;
      }

      showMsg('ok', `<i class="fa-solid fa-circle-check"></i> Account created successfully. Redirecting...`);
      setTimeout(() => window.location.href = '/dashboard/', 650);
    }

    document.addEventListener('DOMContentLoaded', async () => {
      supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      setMode('login');
      document.getElementById('tabLogin').addEventListener('click', () => setMode('login'));
      document.getElementById('tabSignup').addEventListener('click', () => setMode('signup'));

      document.getElementById('loginForm').addEventListener('submit', handleLogin);
      document.getElementById('signupForm').addEventListener('submit', handleSignup);

      await redirectIfLoggedIn();
    });
  </script>
</head>

<body>
  <header id="navbar">
    <a href="/" class="logo-container">
      <img src="/image/logo.png" alt="FoodShare Seychelles Logo" class="logo-img">
      FoodShare <span style="color: var(--primary-main);">Seychelles</span>
    </a>
    <nav class="nav-links-container">
      <a href="/available-food/" class="nav-link">Find Food</a>
      <a href="/donate-now/" class="nav-link">Donate</a>
      <a href="/volunteer-now/" class="nav-link">Volunteer</a>
      <a href="/our-impact/" class="nav-link">Impact</a>
      <a href="/about/" class="nav-link">About Us</a>
      <a href="/donate-now/" class="cta-button">DONATE NOW</a>
      <a href="/staff-login/" class="staff-login nav-link">Staff Login</a>
    </nav>
  </header>

  <main>
    <div class="content-container">
      <div class="hero">
        <section class="panel">
          <div class="panel-inner">
            <h1>Community Account</h1>
            <p class="sub">
              Create your FoodShare Seychelles account to claim available food, track your requests, and receive updates
              directly in your personal dashboard.
            </p>

            <div class="bullets">
              <div class="bullet"><span class="dot"></span><div><b>Track requests</b><div class="sub">Claims, donations, and volunteer applications—all in one place.</div></div></div>
              <div class="bullet"><span class="dot"></span><div><b>Automatic updates</b><div class="sub">Get notifications when your request is reviewed or scheduled.</div></div></div>
              <div class="bullet"><span class="dot"></span><div><b>Secure access</b><div class="sub">Your data is protected with Supabase authentication and access control.</div></div></div>
            </div>

            <div class="tiny">
              Already staff or admin? Use <a href="/staff-login/">Staff Login</a>.
            </div>
          </div>
        </section>

        <section class="panel">
          <div class="panel-inner">
            <div class="tabs">
              <button class="tab active" id="tabLogin" type="button"><i class="fa-solid fa-right-to-bracket"></i> Sign In</button>
              <button class="tab" id="tabSignup" type="button"><i class="fa-solid fa-user-plus"></i> Create Account</button>
            </div>

            <div id="msg" class="msg"></div>

            <div id="loginBox">
              <form id="loginForm">
                <label for="loginEmail">Email Address</label>
                <input id="loginEmail" type="email" required placeholder="you@example.com"/>

                <label for="loginPassword">Password</label>
                <input id="loginPassword" type="password" required placeholder="••••••••"/>

                <button id="loginBtn" class="btn" type="submit">Sign In</button>
              </form>
            </div>

            <div id="signupBox" style="display:none;">
              <form id="signupForm">
                <label for="signupName">Full Name</label>
                <input id="signupName" type="text" required placeholder="Your name"/>

                <label for="signupEmail">Email Address</label>
                <input id="signupEmail" type="email" required placeholder="you@example.com"/>

                <label for="signupPassword">Password</label>
                <input id="signupPassword" type="password" required placeholder="Minimum 8 characters"/>

                <button id="signupBtn" class="btn" type="submit">Create Account</button>

                <button class="btn secondary" type="button" onclick="setMode('login')">I already have an account</button>
              </form>
            </div>

            <div class="tiny">
              By continuing, you agree to our <a href="/terms-of-use/">Terms of Use</a> and <a href="/privacy-policy/">Privacy Policy</a>.
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <footer id="main-footer">
    <div class="content-container footer-content">
      <div class="footer-section"><h3>Quick Links</h3><ul><li><a href="/available-food/">Find Food</a></li><li><a href="/donate-now/">Donate</a></li><li><a href="/volunteer-now/">Volunteer</a></li><li><a href="/our-impact/">Impact</a></li><li><a href="/contact-general/">General Contact</a></li></ul></div>
      <div class="footer-section"><h3>Learn More</h3><ul><li><a href="/about/">About FoodShare</a></li><li><a href="/our-partners/">Our Partners</a></li><li><a href="/learn/safety/">Food Safety Protocol</a></li><li><a href="/learn/faq/">General FAQ</a></li></ul></div>
      <div class="footer-section"><h3>Support & Legal</h3><ul><li><a href="/privacy-policy/">Privacy Policy</a></li><li><a href="/terms-of-use/">Terms of Use</a></li><li><a href="/sitemap/">Site Structure</a></li><li><a href="/staff-login/">Staff Login</a></li></ul></div>
      <div class="footer-section">
        <h3>Get In Touch</h3>
        <p>Email: <a href="mailto:admin@foodshare-seychelles.online" style="color: var(--primary-main);">admin@foodshare-seychelles.online</a></p>
        <p>Follow us on <a href="/social/" style="color: var(--primary-main); display:inline;">Social Media</a></p>
      </div>
    </div>
    <div class="footer-bottom">&copy; 2025 Foodshare Seychelles. All Rights Reserved.</div>
  </footer>
</body>
</html>
