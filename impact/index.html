<body>
    <header id="navbar">
        <a href="/" class="logo-container"> <img src="/image/logo.png" alt="FoodShare Seychelles Logo" class="logo-img"> 
            FoodShare <span style="color: var(--primary-main);">Seychelles</span>
        </a>

        <nav class="nav-links-container" id="navLinks">
            <a href="/available-food/" class="nav-link">Find Food</a>
            <a href="/donate-food/" class="nav-link">Donate</a>
            <a href="/volunteer/" class="nav-link">Volunteer</a>
            <a href="/impact/" class="nav-link">Impact</a>
            <a href="/about/" class="nav-link">About Us</a>
            <a href="/donate-food/" class="cta-button">DONATE NOW</a> <a href="/staff-login/" class="staff-login nav-link">Staff Login</a>
        </nav>
    </header>

    <main>
        <div class="content-container">
            <div class="report-section">
                <h2>Our Mission & Data Transparency</h2>
                <h3 style="margin-top: 30px;">Food Category Breakdown (Year to Date)</h3>
                <div id="categoryBreakdown" style="padding: 15px; background-color: var(--neutral-bg); border-radius: 8px;">
                    <p style="font-weight: bold; margin-bottom: 10px;">Loading categories...</p>
                    <ul id="categoryList"></ul>
                </div>

                <p style="margin-top: 15px; font-size: 0.9em; color: var(--text-light);">*Data below is estimated without a dedicated charting library, but it correctly pulls aggregated food types from the database.</p>
            </div>
        </div>
    </main>

    <footer id="main-footer">
        <div class="content-container footer-content">
            <div class="footer-section"><h3>Quick Links</h3><ul><li><a href="/available-food/">Find Food</a></li><li><a href="/donate-food/">Donate Food</a></li><li><a href="/volunteer/">Volunteer</a></li><li><a href="/impact/">Impact & Reports</a></li><li><a href="/contact-general/">General Contact</a></li></ul></div>
            <div class="footer-section"><h3>Learn More</h3><ul><li><a href="/about/">About FoodShare</a></li><li><a href="/our-partners/">Our Partners</a></li><li><a href="/learn/safety/">Food Safety Protocol</a></li><li><a href="/learn/faq/">General FAQ</a></li></ul></div>
            <div class="footer-section"><h3>Support & Legal</h3><ul><li><a href="/privacy-policy/">Privacy Policy</a></li><li><a href="/terms-of-use/">Terms of Use</a></li><li><a href="/sitemap/">Site Structure</a></li><li><a href="/staff-login/">Staff Login</a></li></ul></div>
            <div class="footer-section">
                <h3>Get In Touch</h3>
                <p>Email: <a href="mailto:admin@foodshare-seychelles.online" style="color: var(--primary-main);">admin@foodshare-seychelles.online</a></p>
                <p>Follow us on 
                    <a href="/social/" style="color: var(--primary-main); display: inline;">Social Media</a>
                </p>
            </div>
        </div>
        <div class="footer-bottom">&copy; 2025 Foodshare Seychelles. All Rights Reserved.</div>
    </footer>
</body>
<script>
    // ... (Existing Supabase URL/Key and initialization) ...
    // ... (fetchImpactData function remains the same, but add call to fetchCategories) ...

    async function fetchImpactData() {
        // ... (Existing metric fetching logic) ...
        
        // After fetching standard metrics, fetch and display categories
        fetchCategories();
        
        // ... (Rest of the function remains the same) ...
    }

    // New function to handle category breakdown
    async function fetchCategories() {
        const { data: categoryData, error } = await supabase
            .from('donation_requests')
            .select('food_type, quantity_kg');
        
        const categoryListEl = document.getElementById('categoryList');
        categoryListEl.innerHTML = '';
        
        if (error || !categoryData || categoryData.length === 0) {
            categoryListEl.innerHTML = '<li>No completed donation data available to categorize.</li>';
            return;
        }

        // Group and sum quantities by food_type
        const categoryMap = categoryData.reduce((acc, item) => {
            const type = item.food_type || 'Unknown';
            acc[type] = (acc[type] || 0) + (item.quantity_kg || 0);
            return acc;
        }, {});

        // Convert map to array and sort
        const categories = Object.entries(categoryMap)
            .sort(([, a], [, b]) => b - a); // Sort by quantity descending

        // Populate the list
        categories.forEach(([type, quantity]) => {
            const listItem = document.createElement('li');
            listItem.textContent = `${type}: ${Math.round(quantity).toLocaleString()} kg`;
            categoryListEl.appendChild(listItem);
        });

        document.getElementById('categoryBreakdown').querySelector('p').style.display = 'none'; // Hide "Loading" text
    }

    document.addEventListener('DOMContentLoaded', () => {
        // ... (Initialization) ...
        fetchImpactData();
    });
</script>
</html>
