<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management - FoodShare Seychelles</title>
    <link rel="icon" href="/image/logo.png" type="image/png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
    
    <style>
        /* [START SHARED CSS VARIABLES & BASE STYLES] */
        :root {
            --primary-light: #81C784; --primary-main: #4CAF50; --primary-dark: #388E3C; 
            --admin-main: #1A237E; /* Deep Indigo */ --admin-light: #BBDEFB;
            --accent-blue: #2196F3; --accent-orange: #FF9800; --accent-red: #E53935;
            --neutral-bg: #F9F9F9; --neutral-card: #FFFFFF; --text-dark: #333333; 
            --text-light: #666666; --shadow-subtle: 0 4px 12px rgba(0, 0, 0, 0.08);
            --font-sans: 'Helvetica Neue', Arial, sans-serif;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-sans); color: var(--text-dark); background-color: var(--neutral-bg); line-height: 1.6; display: flex; min-height: 100vh; }
        
        /* Layout */
        .sidebar { width: 280px; background-color: var(--admin-main); color: white; padding: 20px; box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1); flex-shrink: 0; }
        .main-content { flex-grow: 1; padding: 40px; }
        
        /* Sidebar Navigation */
        .sidebar h2 { color: var(--admin-light); margin-bottom: 30px; font-size: 1.6em; }
        .sidebar-nav a { display: block; color: rgba(255, 255, 255, 0.8); text-decoration: none; padding: 12px 10px; margin-bottom: 5px; border-radius: 6px; transition: background-color 0.3s, color 0.3s; }
        .sidebar-nav a:hover, .sidebar-nav a.active { background-color: #283593; color: white; }
        .sidebar-nav a i { margin-right: 10px; }

        /* General Sections */
        .section-header { border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;}
        
        /* Utility Buttons */
        .btn-primary { background-color: var(--primary-main); color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; font-weight: bold; }
        .btn-primary:hover { background-color: var(--primary-dark); }

        /* [START INVENTORY SPECIFIC CSS] */
        .inventory-table { width: 100%; border-collapse: collapse; background-color: var(--neutral-card); box-shadow: var(--shadow-subtle); border-radius: 8px; overflow: hidden; margin-top: 20px; }
        .inventory-table th, .inventory-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; }
        .inventory-table th { background-color: var(--admin-light); color: var(--admin-main); font-weight: bold; }
        .inventory-table tr:hover { background-color: #f5f5f5; }

        .status-low { color: var(--accent-red); font-weight: bold; }
        .status-normal { color: var(--primary-dark); }
        .status-urgent { color: var(--accent-orange); font-weight: bold; }

        .action-btns button { background: none; border: none; color: var(--accent-blue); cursor: pointer; margin-right: 10px; transition: color 0.2s; }
        .action-btns button:hover { color: var(--admin-main); }
        /* [END INVENTORY SPECIFIC CSS] */

    </style>
    
    <script>
        const SUPABASE_URL = 'https://edotvuleaydztulkxehe.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVkb3R2dWxlYXlkenR1bGt4ZWhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2MDAyNDYsImV4cCI6MjA4MTE3NjI0Nn0.gDni31MI8twOpNmNcIpj1jGsra75eZ2iLL6gQM0i9lw';
        let supabase;

        async function checkAuthAndRedirect() {
            if (window.supabase && window.supabase.createClient) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            } else {
                return; 
            }

            const { data: { session } } = await supabase.auth.getSession();
            
            if (!session) {
                window.location.href = '/staff-login/';
                return;
            }
            
            const user = session.user;
            const { data: profile } = await supabase.from('profiles').select('role_id').eq('id', user.id).single();
            
            // Only allow role_id=1 (Admin) to proceed.
            if (!profile || profile.role_id !== 1) { 
                alert('Authorization Failed: You are not authorized as an Admin. Redirecting.');
                await supabase.auth.signOut();
                window.location.href = '/staff-login/';
                return;
            }
            
            // If role is 1 (Admin), proceed to load data
            fetchInventory();
        }

        async function fetchInventory() {
            const tableBody = document.getElementById('inventoryTableBody');
            tableBody.innerHTML = '';
            
            // --- Placeholder Mock Data (Replace with actual Supabase query) ---
            // const { data: inventoryItems, error } = await supabase.from('inventory').select('*');
            
            const mockInventory = [
                { id: 101, item: "Fresh Cabbage", quantity: 50, unit: "Kg", expiry: "2025-12-18", location: "Cool Room A", status: "Urgent" },
                { id: 102, item: "Canned Fish", quantity: 150, unit: "Units", expiry: "2026-10-01", location: "Dry Storage 1", status: "Normal" },
                { id: 103, item: "Frozen Meat", quantity: 12, unit: "Boxes", expiry: "2026-01-20", location: "Freezer Bay", status: "Low" },
                { id: 104, item: "Bread Loaves", quantity: 5, unit: "Units", expiry: "2025-12-15", location: "Dry Storage 2", status: "Urgent" },
            ];
            // --- End Mock Data ---

            mockInventory.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.item}</td>
                    <td>${item.quantity} ${item.unit}</td>
                    <td><span class="status-${item.status.toLowerCase()}">${item.status}</span></td>
                    <td>${item.expiry}</td>
                    <td>${item.location}</td>
                    <td class="action-btns">
                        <button title="Log Usage/Distribution" onclick="logUsage(${item.id})"><i class="fas fa-arrow-up-right-from-square"></i> Log Out</button>
                        <button title="Edit Item Details" onclick="editItem(${item.id})"><i class="fas fa-edit"></i> Edit</button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }
        
        // Placeholder functions for interactivity
        function openAddItemModal() {
            alert("Opening Modal to Add New Inventory Item.");
            // In a real application, you would show a modal form here.
        }

        function logUsage(itemId) {
            alert(`Log usage for item ID ${itemId}. This would open a form to record distribution.`);
        }
        
        function editItem(itemId) {
            alert(`Editing item ID ${itemId}. This would load the item's data into a form.`);
        }

        async function logoutUser() {
            if (!supabase) return;
            const { error } = await supabase.auth.signOut();
            if (!error) {
                window.location.href = '/staff-login/';
            }
        }

        document.addEventListener('DOMContentLoaded', checkAuthAndRedirect);
    </script>
</head>
<body>
    <div class="sidebar">
        <h2><i class="fas fa-chart-line"></i> Admin Panel</h2>
        <nav class="sidebar-nav">
            <a href="/admin-dashboard/"><i class="fas fa-home"></i> Dashboard Home</a>
            <a href="/admin/inventory" class="active"><i class="fas fa-boxes"></i> Inventory Management</a>
            <a href="/admin/donations"><i class="fas fa-hand-holding-heart"></i> Donation Requests</a>
            <a href="/admin/staff-tasks"><i class="fas fa-tasks"></i> Staff Tasks</a>
            <a href="/admin/volunteer-apps"><i class="fas fa-users"></i> Volunteer Apps</a>
            <a href="/admin/settings"><i class="fas fa-cog"></i> Site Settings</a>
            <a href="#" onclick="logoutUser()"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </nav>
    </div>

    <div class="main-content">
        <h1>Inventory Management</h1>
        <p>Control the stock levels, locations, and expiration dates of all rescued food.</p>

        <section class="section">
            <h2 class="section-header">
                Current Food Stock
                <button class="btn-primary" onclick="openAddItemModal()">
                    <i class="fas fa-plus"></i> Add New Item
                </button>
            </h2>
            
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Quantity</th>
                        <th>Status</th>
                        <th>Expiry Date</th>
                        <th>Location</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="inventoryTableBody">
                    <tr>
                        <td colspan="6">Loading inventory data...</td>
                    </tr>
                </tbody>
            </table>
        </section>
        
        </div>
</body>
</html>
